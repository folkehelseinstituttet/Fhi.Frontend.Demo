<ng-container *ngIf="diagramOptions !== undefined">
  <ng-container *ngIf="diagramOptions.diagramTypeNav !== undefined">
    <ng-container *ngTemplateOutlet="diagramTypeNav"></ng-container>
  </ng-container>

  <ng-container [ngSwitch]="currentDiagramTypeGroup">
    <ng-container *ngSwitchCase="diagramTypeGroups.table">
      <ng-container *ngTemplateOutlet="table"></ng-container>
    </ng-container>
    <ng-container *ngSwitchCase="diagramTypeGroups.map">
      <ng-container *ngIf="allMapsLoaded">
        <ng-container *ngTemplateOutlet="map"></ng-container>
      </ng-container>
    </ng-container>
    <ng-container *ngSwitchCase="diagramTypeGroups.chart">
      <ng-container *ngIf="showDefaultChartTemplate; else chartAnimationHack">
        <ng-container *ngTemplateOutlet="chart"></ng-container>
      </ng-container>
      <ng-template #chartAnimationHack><!-- to get correct chart animation when switching from one chart type to another -->
        <ng-container *ngTemplateOutlet="chart"></ng-container>
      </ng-template>
    </ng-container>
  </ng-container>
</ng-container>


<ng-template #diagramTypeNav>
  <fhi-diagram-type-nav
    *ngIf="diagramOptions.diagramTypeNav === diagramTypeNavs.default"
    [currentDiagramTypeGroup]="currentDiagramTypeGroup"
    [currentDiagramType]="diagramOptions.diagramType"
    (navigateToDiagramType)="onDiagramTypeNav($event)">
  </fhi-diagram-type-nav>
</ng-template>

<ng-template #chart>
  <highcharts-chart
    class="fhi-highcharts-chart"
    [Highcharts]="Highcharts"
    [options]="highchartsOptions">
  </highcharts-chart>

  <!-- DEBUGGING -->
  <!-- <pre *ngIf="anonymizedSeries[0] !== undefined">Serier med "prikkede" verdier: <br>{{ anonymizedSeries | json }}</pre> -->
</ng-template>

<ng-template #map>
  <highcharts-chart
    class="fhi-highcharts-map"
    [Highcharts]="Highcharts"
    [constructorType]="'mapChart'"
    [options]="highchartsOptions">
  </highcharts-chart>
</ng-template>

<ng-template #table>
  <article class="fhi-highcharts-table">
    <h1 class="h4">{{ tableTitle }}</h1>
    <div class="table-responsive">
      <table class="table table-striped table-sm mt-3">
        <thead>
          <tr class="fhi-highcharts-table__row" *ngFor="let headerRow of tableHeaderRows">
            <ng-container *ngFor="let tableCellData of headerRow; let i = index">
              <ng-container *ngIf="tableCellData">
                <td class="fhi-highcharts-table__cell fhi-highcharts-table__cell--col-header"
                    [attr.rowspan]="(tableCellData.rowspan) ? tableCellData.rowspan : null"
                    *ngIf="i === 0; else tableHeaderCell"></td>
                <ng-template #tableHeaderCell>
                  <th class="fhi-highcharts-table__cell fhi-highcharts-table__cell--col-header"
                      [attr.style]="'width: calc(100% /' + (headerRow.length - 1) + ');'"
                      [attr.colspan]="(tableCellData.colspan) ? tableCellData.colspan : null"
                      scope="col">
                    {{ tableCellData.name }}
                  </th>
                </ng-template>
              </ng-container>
            </ng-container>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let tableRow of tableBodyRows" class="fhi-highcharts-table__row">
            <ng-container *ngFor="let tableCellData of tableRow; let i = index">
              <th *ngIf="i === 0" scope="row"
                   class="text-nowrap fhi-highcharts-table__cell fhi-highcharts-table__cell--row-header">
                {{ tableCellData }}
              </th>
              <td class="fhi-highcharts-table__cell" *ngIf="i !== 0">
                <ng-container *ngIf="tableCellDataOK(tableCellData); else tableCellDataIsString">
                  {{ tableCellData | number }}
                </ng-container>
                <ng-template #tableCellDataIsString>
                  {{ tableCellData }}
                </ng-template>
              </td>
            </ng-container>
          </tr>
        </tbody>
      </table>
    </div>
    <footer class="fhi-highcharts-table__footer">
      <div class="fhi-highcharts-table__caption">
        <p class="fhi-highcharts-table__caption-last-update mb-0"
           *ngIf="tableLastUpdated">Oppdatert: {{ tableLastUpdated }}</p>
        <p class="fhi-highcharts-table__caption-disclaimer mb-0"
           *ngIf="tableDisclaimer"
           [innerHTML]="tableDisclaimer">
        </p>
        <a href="{{ tableCreditsHref }}" class="fhi-highcharts-table__credits">{{ tableCreditsText }}</a>
      </div>
    </footer>
  </article>
</ng-template>
