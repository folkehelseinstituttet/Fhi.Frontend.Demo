<ng-container [ngSwitch]="currentDiagramTemplate">
  <ng-container *ngSwitchCase="diagramTemplates.table">
    <ng-container *ngTemplateOutlet="chart"></ng-container><!-- Create chartInstance to get csv for the table -->
    <ng-container *ngTemplateOutlet="table"></ng-container>
  </ng-container>
  <ng-container *ngSwitchCase="diagramTemplates.map">
    <ng-container *ngIf="allMapsLoaded">
      <ng-container *ngTemplateOutlet="map"></ng-container>
    </ng-container>
  </ng-container>
  <ng-container *ngSwitchCase="diagramTemplates.chart">
    <ng-container *ngIf="showDefaultChartTemplate; else chartAnimationHack">
      <ng-container *ngTemplateOutlet="chart"></ng-container>
    </ng-container>
    <ng-template #chartAnimationHack><!-- to get correct chart animation when switching from one chart type to another -->
      <ng-container *ngTemplateOutlet="chart"></ng-container>
    </ng-template>
  </ng-container>
</ng-container>

<ng-template #chart>
  <highcharts-chart
    class="fhi-highcharts"
    [ngClass]="{'d-none': currentDiagramTemplate === diagramTemplates.table}"
    [Highcharts]="highcharts"
    [options]="options"
    (chartInstance)="onChartInstance($event)">
  </highcharts-chart>
</ng-template>

<ng-template #map>
  <highcharts-chart
    class="fhi-highcharts fhi-highcharts-map"
    [Highcharts]="highcharts"
    [constructorType]="'mapChart'"
    [options]="options"
    (chartInstance)="onChartInstance($event)">
  </highcharts-chart>
</ng-template>

<ng-template #table>
  <article class="fhi-highcharts-table">
    <h1 class="fhi-highcharts-table__title">{{ tableTitle }}</h1>
    <div class="table-responsive">
      <table class="table table-sm table-bordered mt-3 fhi-highcharts-table__table">
        <thead>
          <tr class="fhi-highcharts-table__row">
            <th *ngFor="let tableCellData of tableHeaderRow; let i = index"
                [scope]="i === 0 ? 'row' : 'col'"
                class="fhi-highcharts-table__cell fhi-highcharts-table__cell--header text-center">
              <span>{{ tableCellData }}</span>
            </th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let tableRow of tableBodyRows" class="fhi-highcharts-table__row">
            <ng-container *ngFor="let tableCellData of tableRow; let i = index">
              <th *ngIf="i === 0" scope="row" class="fhi-highcharts-table__cell sum" 
                [ngClass]="{'fhi-highcharts-table__cell--sum': includeSumRow}">{{ tableCellData }}</th>
              <td class="fhi-highcharts-table__cell text-right" 
                [ngClass]="{'fhi-highcharts-table__cell--sum': includeSumRow}" *ngIf="i !== 0">{{ tableCellData | number }}</td>
            </ng-container>
          </tr>
        </tbody>
      </table>
    </div>
    <footer class="fhi-highcharts-table__footer">
      <div class="fhi-highcharts-table__caption">
        <p class="fhi-highcharts-table__caption-last-update">Oppdatert: {{ config.captionLastUpdated }}</p>
        <p
          class="fhi-highcharts-table__caption-disclaimer"
          *ngIf="config.captionDisclaimer"
          [innerHTML]="config.captionDisclaimer">
        </p>
        <a href="{{ config.creditsHref }}" class="fhi-highcharts-table__credits">{{ config.creditsText }}</a>
      </div>
    </footer>
  </article>
</ng-template>
