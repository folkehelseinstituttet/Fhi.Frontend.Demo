<div class="fhi-tree-view-navigation">
	<ng-container *ngTemplateOutlet="nodeList; context: { nodes: nodes }"></ng-container>
</div>


<ng-template #nodeList let-nodes="nodes" let-nodeId="nodeId">
	<ul class="fhi-tree-view-navigation__list"
			role="tree"
			[id]="'id-' + nodeId"
			[attr.aria-labelledby]="nodeId !== undefined ?'branch-' + nodeId : null">
		<li class="fhi-tree-view-navigation__node" *ngFor="let node of nodes" role="treeitem">
			<div class="d-flex w-100">
				<ng-container *ngIf="node.routerLink">
					<ng-container *ngTemplateOutlet="routerLink; context: { node: node }"></ng-container>
				</ng-container>

				<ng-container *ngIf="node.href">
					<ng-container *ngTemplateOutlet="href; context: { node: node }"></ng-container>
				</ng-container>

				<ng-container *ngIf="!node.routerLink && !node.href">
					<ng-container *ngTemplateOutlet="text; context: { node: node }"></ng-container>
				</ng-container>

				<ng-container *ngIf="node.children">
					<ng-container *ngTemplateOutlet="expandButton; context: { node: node }"></ng-container>
				</ng-container>
			</div>

			<ng-container *ngIf="node.isExpanded && node.children">
				<div class="fhi-tree-view-navigation__nested-group">
					<ng-container *ngTemplateOutlet="nodeList; context: { nodes: node.children, nodeId: node.id }"></ng-container>
				</div>
			</ng-container>
		</li>
	</ul>
</ng-template>


<ng-template #expandButton let-node="node">
	<button
		class="fhi-tree-view-navigation__toggler"
		[attr.aria-label]="'Toggle ' + node.name"
		[attr.aria-controls]="'id-' + node.id"
		[attr.aria-haspopup]="'tree'"
		[attr.aria-expanded]="node.isExpanded"
		(click)="toggleNode(node)"
	>
		<i
			[ngClass]="{
				'icon-chevron-up' : node.isExpanded,
				'icon-chevron-down' : !node.isExpanded
			}"
		>
		</i>
	</button>
</ng-template>


<ng-template #routerLink let-node="node">
	<a
		class="fhi-tree-view-navigation__link"
		[routerLink]="node.routerLink"
		routerLinkActive="active"
		[id]="'branch-' + node.id"
	>
		{{ node.name }}
	</a>
</ng-template>


<ng-template #href let-node="node">
	<a
		class="fhi-tree-view-navigation__link"
		[ngClass]="{ 'active': node.hasActiveDescendant }"
		href="{{ node.href }}"
		[id]="'branch-' + node.id"
	>
		{{ node.name }}
	</a>
</ng-template>


<ng-template #text let-node="node">
	<span
		class="fhi-tree-view-navigation__no-link"
		[ngClass]="{ 'active': node.hasActiveDescendant || node.isActive }"
		*ngIf="!node.link"
		[id]="'branch-' + node.id"
	>
		{{ node.name }}
	</span>
</ng-template>
